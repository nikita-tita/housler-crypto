# Задачи для TPM — housler-crypto

**Дата:** 2026-01-16
**Источник:** Мануальное тестирование экосистемы + BACKLOG

---

## Статус библиотеки

| Компонент | Статус |
|-----------|--------|
| Python package | ✅ v1.0.0 готов |
| TypeScript package | ✅ v1.0.0 готов |
| Tests | ✅ 147 tests passing |
| CI/CD | ✅ Green |
| PyPI publish | ❌ Blocked (Trusted Publishing) |
| npm publish | ❌ Blocked (NPM_TOKEN) |

---

## Блокеры публикации

### PUBLISH-001: PyPI Trusted Publishing
**Приоритет:** MEDIUM
**Исполнитель:** BE-CRYPTO / DevOps

**Описание:** PyPI требует настройки Trusted Publishing для GitHub Actions.

**Шаги:**
1. Открыть https://pypi.org/manage/project/housler-crypto/settings/publishing/
2. Add publisher → GitHub Actions
3. Repository: `nikita-tita/housler-crypto`
4. Workflow: `release.yml`
5. Push новый tag для триггера

**DoD:**
- [ ] Trusted Publishing настроен
- [ ] `pip install housler-crypto` работает
- [ ] Версия на PyPI соответствует GitHub

---

### PUBLISH-002: npm NPM_TOKEN
**Приоритет:** MEDIUM
**Исполнитель:** BE-CRYPTO / DevOps

**Описание:** GitHub Actions не имеет NPM_TOKEN для публикации.

**Шаги:**
1. Создать NPM_TOKEN на https://www.npmjs.com/settings/tokens
2. GitHub → Settings → Secrets → Add `NPM_TOKEN`
3. Push tag: `git tag v1.0.1 && git push --tags`

**DoD:**
- [ ] NPM_TOKEN добавлен в secrets
- [ ] `npm install @housler/crypto` работает
- [ ] Версия на npm соответствует GitHub

---

## Интеграция с экосистемой

### CRYPTO-002: Интегрировать в agent.housler.ru
**Приоритет:** MEDIUM
**Зависимость:** PUBLISH-001, PUBLISH-002
**Исполнитель:** BE-AGENT

**После публикации:**
1. `npm install @housler/crypto` в agent backend
2. Заменить `src/utils/encryption.ts` на импорт из библиотеки
3. Удалить дублирующий код
4. Тесты

---

### CRYPTO-003: Миграция данных на hc1:
**Приоритет:** MEDIUM
**Зависимость:** CRYPTO-002
**Исполнитель:** BE-AGENT + DBA

**Описание:** Перешифровать все PII данные в новый формат `hc1:`.

**DoD:**
- [ ] Migration script
- [ ] Backup БД
- [ ] Данные мигрированы
- [ ] encrypt() переключён на hc1:

---

## Матрица назначений

| Задача | Исполнитель | Приоритет | Сложность |
|--------|-------------|-----------|-----------|
| PUBLISH-001 | BE-CRYPTO | MEDIUM | S (30 мин) |
| PUBLISH-002 | BE-CRYPTO | MEDIUM | S (15 мин) |
| CRYPTO-002 | BE-AGENT | MEDIUM | M (4-6 часов) |
| CRYPTO-003 | BE-AGENT + DBA | MEDIUM | M (3-4 часа) |

---

## Порядок выполнения

```
1. PUBLISH-001 (PyPI) — можно сразу
   ↓
2. PUBLISH-002 (npm) — параллельно
   ↓
3. CRYPTO-002 (интеграция) — после публикации
   ↓
4. CRYPTO-003 (миграция) — после интеграции
```

---

## Критические правила

1. **Совместимость:** Python ↔ TypeScript encrypt/decrypt ОБЯЗАНЫ быть совместимы
2. **Coverage:** ≥ 90% (текущий: 95%+)
3. **No breaking changes** без major version bump
4. **Security:** Нет хардкода ключей в тестах

---

*Создано: 2026-01-16*
